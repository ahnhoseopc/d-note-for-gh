CREATE INDEX op_names_idx ON JAIN_OCS.OCMOPR06 (OCM06CMTA) INDEXTYPE IS CTXSYS.CONTEXT;
DROP INDEX op_names_idx;

SELECT OEY07SPTH, OEY07IDNOA, OEY07LWDAT, OEY07OPDAT, OEY07HOPDAT, 
SUBSTR(OEY07CMTA, 
         INSTR(OEY07CMTA, '|', 1, 6)+1, 
         INSTR(OEY07CMTA, '|', 1, 7)-INSTR(OEY07CMTA, '|', 1, 6)-1)  OPNAME07
FROM JAIN_OCS.OEYOPR07 OPR07 
WHERE 1=1
AND OEY07LWDAT >= '20240101'
AND OEY07SPTH IN ('002806' , '001639')
;

SELECT OCM06CMTA FROM JAIN_OCS.OCMOPR06 
WHERE CONTAINS(OCM06CMTA, 'near(LEEP, removel, 2)') > 0
;
SELECT OCM06CMTA FROM JAIN_OCS.OCMOPR06 
WHERE CONTAINS(OCM06CMTA, 'fuzzy("septo rf")') > 0
;

    SELECT DISTINCT OEY07IDNOA, OEY07LWDAT, 
        REPLACE(REPLACE(REPLACE(
        TRIM(BOTH ' ' FROM (TRIM(BOTH CHR(10) FROM 
        SUBSTR(OEY07CMTA, 
                INSTR(OEY07CMTA, '|', 1, 6)+1, 
                INSTR(OEY07CMTA, '|', 1, 7)-INSTR(OEY07CMTA, '|', 1, 6)-1
            )
        ))), CHR(9)), CHR(13)), CHR(10), CHR(10))  OPNAME
    FROM JAIN_OCS.OEYOPR07 OPR07 
    WHERE 1=1 AND ROWNUM < 100
    -- AND OEY07IDNOA = '0642544'
    -- AND OEY07LWDAT = '20241205'
    AND OEY07SPTH IN ('002806' , '001639');

WITH NN as (SELECT LEVEL POS FROM DUAL CONNECT BY LEVEL < 20),
    OP AS (
    SELECT DISTINCT 
        REPLACE(REPLACE(REPLACE(
        TRIM(BOTH ' ' FROM (TRIM(BOTH CHR(9) FROM 
        SUBSTR(OEY07CMTA, 
                INSTR(OEY07CMTA, '|', 1, 6)+1, 
                INSTR(OEY07CMTA, '|', 1, 7)-INSTR(OEY07CMTA, '|', 1, 6)-1
            )
        ))), CHR(9)), CHR(13)), CHR(10), CHR(10))  OPNAME
    FROM JAIN_OCS.OEYOPR07 OPR07 
    WHERE 1=1 AND ROWNUM < 100
    AND OEY07IDNOA = '1018708'
    AND OEY07LWDAT = '20241223'
    AND OEY07SPTH IN ('002806' , '001639')
)
SELECT POS, regexp_substr(OPNAME, '[^'||CHR(10)||']+', 1, POS) AOP
FROM OP CROSS JOIN NN
-- CONNECT BY regexp_substr(OPNAME, '[^'||CHR(10)||']+', 1, LEVEL) IS NOT NULL
WHERE regexp_substr(OPNAME, '[^'||CHR(10)||']+', 1, POS) IS NOT NULL
;
        SELECT DISTINCT 
            REPLACE(REPLACE(REPLACE(
            TRIM(BOTH CHR(10) FROM (TRIM(BOTH CHR(9) FROM 
            SUBSTR(OEY07CMTA, 
                    INSTR(OEY07CMTA, '|', 1, 6)+1, 
                    INSTR(OEY07CMTA, '|', 1, 7)-INSTR(OEY07CMTA, '|', 1, 6)-1
                )
            ))), CHR(9)), CHR(13)), CHR(10), CHR(10))  OP07NAME
        FROM JAIN_OCS.OEYOPR07 OPR07 
        WHERE 1=1 AND ROWNUM < 100
        AND OEY07IDNOA = '0642544'
        AND OEY07LWDAT = '20241205';

        SELECT DISTINCT 
            REPLACE(REPLACE(REPLACE(
            TRIM(BOTH CHR(10) FROM (TRIM(BOTH CHR(9) FROM 
            SUBSTR(OCM06CMTA, 
                    INSTR(OCM06CMTA, '|', 1, 8)+1, 
                    INSTR(OCM06CMTA, '|', 1, 9)-INSTR(OCM06CMTA, '|', 1, 8)-1
                )
            ))), CHR(9)), CHR(13)), CHR(10), CHR(10))  OP06NAME
        FROM JAIN_OCS.OCMOPR06 
        WHERE 1=1 AND ROWNUM < 100
        AND OCM06IDNOA = '0642544'
        AND OCM06LWDAT = '20241205';

WITH NN as (SELECT LEVEL NNPOS FROM DUAL CONNECT BY LEVEL < 20),
    OP07 AS (
        SELECT DISTINCT 
            REPLACE(REPLACE(REPLACE(
            TRIM(BOTH CHR(10) FROM (TRIM(BOTH CHR(9) FROM 
            SUBSTR(OEY07CMTA, 
                    INSTR(OEY07CMTA, '|', 1, 6)+1, 
                    INSTR(OEY07CMTA, '|', 1, 7)-INSTR(OEY07CMTA, '|', 1, 6)-1
                )
            ))), CHR(9)), CHR(13)), CHR(10), CHR(10))  OP07NAME
        FROM JAIN_OCS.OEYOPR07 OPR07 
        WHERE 1=1 AND ROWNUM < 100
        AND OEY07IDNOA = '1018708'
        AND OEY07LWDAT = '20241223'
        AND OEY07SPTH IN ('002806' , '001639')
    ),
    OP06 AS (
        SELECT DISTINCT OCM06LWDAT,
            REPLACE(REPLACE(REPLACE(
            TRIM(BOTH CHR(10) FROM (TRIM(BOTH CHR(10) FROM 
            SUBSTR(OCM06CMTA, 
                    INSTR(OCM06CMTA, '|', 1, 8)+1, 
                    INSTR(OCM06CMTA, '|', 1, 9)-INSTR(OCM06CMTA, '|', 1, 8)-1
                )
            ))), CHR(9)), CHR(13)), CHR(10), CHR(10))  OP06NAME
            , OCM06CMTB CMTB
            , OCM06CMTC CMTC
        FROM JAIN_OCS.OCMOPR06
        WHERE 1=1 -- AND ROWNUM < 100
        AND OCM06LWDAT >= '20240101'
        ORDER BY OCM06LWDAT DESC
    )
SELECT NNPOS, CMTB, CMTC, regexp_substr(OP07NAME, '[^'||CHR(10)||']+', 1, NNPOS) AOP
FROM OP06
CROSS JOIN NN
INNER JOIN OP07 ON OP06NAME like '%' || regexp_substr(OP07NAME, '[^'||CHR(10)||']+', 1, NNPOS) || '%'
WHERE regexp_substr(OP07NAME, '[^'||CHR(10)||']+', 1, NNPOS) IS NOT NULL;



    SELECT DISTINCT
        OCM06IDNOA, OCM06LWDAT, REPLACE(REPLACE(REPLACE(
        TRIM(BOTH ' ' FROM (TRIM(BOTH CHR(10) FROM 
        SUBSTR(OEY07CMTA, 
                INSTR(OCM06CMTA, '|', 1, 8)+1, 
                INSTR(OCM06CMTA, '|', 1, 9)-INSTR(OCM06CMTA, '|', 1, 8)-1
            )
        ))), CHR(9)), CHR(13)), CHR(10), CHR(10))  OPNAME
    FROM JAIN_OCS.OCMOPR06 OPR06 
    WHERE 1=1 AND ROWNUM < 100
    AND OPNAME IN (SELECT AOP FROM OPNAME)
    AND OCM06LWDAT >= '20250101'
;


SELECT LEVEL NNPOS FROM DUAL CONNECT BY LEVEL <= 20;