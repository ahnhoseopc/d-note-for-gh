WITH OP AS (
    SELECT OCM06STATUS AS STATUS, OCM06IDNOA AS PATIENT, OCM06LWDAT AS ADMDATE
    , SUBSTR(OCM06CMTA,                         1,INSTR(OCM06CMTA,'|',1,1) -1) AS DOCTOR
    , SUBSTR(OCM06CMTA,INSTR(OCM06CMTA,'|',1,3)+1,INSTR(OCM06CMTA,'|',1,4) - INSTR(OCM06CMTA,'|',1,3)-1) AS DOCTOR2
    , SUBSTR(OCM06CMTA,INSTR(OCM06CMTA,'|',1,7)+1,INSTR(OCM06CMTA,'|',1,8) - INSTR(OCM06CMTA,'|',1,7)-1) AS PREDX 
    , SUBSTR(OCM06CMTA,INSTR(OCM06CMTA,'|',1,8)+1,INSTR(OCM06CMTA,'|',1,9) - INSTR(OCM06CMTA,'|',1,8)-1) AS OPNAME
    , SUBSTR(OCM06CMTA,INSTR(OCM06CMTA,'|',1,11)+1,INSTR(OCM06CMTA,'|',1,12) - INSTR(OCM06CMTA,'|',1,11)-1) AS POSTDX 
    , OCM06CMTA AS OPDATA, OCM06CMTB AS PROCFIND
    FROM JAIN_OCS.OCMOPR06
    WHERE 1=1 -- ROWNUM <= 100
    AND OCM06STATUS='OP2'
    AND OCM06LWDAT >= '20230101'
    AND OCM06LWDAT <  '20240101'
    AND REGEXP_INSTR(OCM06LWDAT, '^\d{4}\d{2}\d{2}') = 1
)
SELECT 
    DOCTOR, PATIENT, ADMDATE, OPNAME, PREDX, POSTDX, PROCFIND
    --DOCTOR, OPNAME, COUNT(1) OVER(PARTITION BY DOCTOR) AS COUNT4D, COUNT(1) AS COUNT4DO , MIN(ADMDATE) AS MINADM, MAX(ADMDATE) AS MAXADM
FROM OP
-- GROUP BY DOCTOR, OPNAME
-- ORDER BY COUNT(1) OVER(PARTITION BY DOCTOR) DESC, COUNT(1) DESC
;
